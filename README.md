# NoSos

NoSos — это мощный инструмент для мониторинга активности игроков на сервере Minecraft. Он предоставляет графическое отображение позиций игроков на карте, генерирует тепловые карты активности, отслеживает нарушения правил и предоставляет гибкие настройки для анализа данных. NoSos идеально подходит для администраторов серверов, которые хотят контролировать активность игроков и оперативно реагировать на нарушения.

---

## Возможности

### Основные функции:
1. **Мониторинг игроков в реальном времени**:
   - Отображение позиций игроков на карте.
   - Отслеживание активности игроков по времени суток.
   - Отображение списка онлайн-игроков с их координатами.

2. **Тепловые карты активности**:
   - Визуализация активности игроков на карте.
   - Настройка количества бинов, цветовой карты и прозрачности.
   - Сохранение и загрузка истории активности для анализа.

3. **Гибкая настройка зон**:
   - Создание зон с различными уровнями оповещений (INFO, WARNING, CRITICAL).
   - Настройка исключённых зон (без генерации алертов).
   - Возможность указания списка игроков, которым разрешено находиться в зоне.

4. **Оповещения**:
   - Автоматическая проверка нарушений (вход в запрещённые зоны, превышение лимита игроков).
   - Логирование событий и уведомлений в файл `monitor.log`.
   - Отображение алертов на графике с указанием типа и уровня важности.

5. **Экспорт данных**:
   - Экспорт статистики игроков и зон в форматы CSV, JSON и Excel.
   - Экспорт времени, проведённого игроками в зонах.
   - Автоматический экспорт данных при завершении работы.

6. **Производительность**:
   - Кэширование данных для повышения производительности.
   - Поддержка многопоточности для обработки данных.
   - Оптимизация работы с большими объёмами данных.

---

## Установка и запуск

### Требования

- Python 3.8 или выше.
- Установленные зависимости (см. ниже).

### Установка зависимостей

Перед запуском приложения установите необходимые зависимости с помощью pip:

```bash
pip install -r requirements.txt
```

### Запуск

Запустите приложение командой:

```bash
python main.py
```

---

## Конфигурация

Конфигурация приложения хранится в файле `config.yaml`. Основные параметры:

### Основные настройки:
- **players_url**: URL для получения данных об игроках.
- **world_bounds**: Границы мира (xmin, xmax, zmin, zmax).
- **update_interval**: Интервал обновления данных (в секундах).
- **min_request_interval**: Минимальный интервал между запросами (в секундах).

### Настройки отображения:
- **display**:
  - **point_size**: Размер точек игроков на карте.
  - **point_color**: Цвет точек игроков.
  - **point_alpha**: Прозрачность точек игроков.
  - **labels**: Настройки подписей игроков (цвет, размер шрифта, смещение).

### Настройки тепловой карты:
- **heatmap**:
  - **bins**: Количество бинов для тепловой карты.
  - **cmap**: Цветовая карта.
  - **alpha**: Прозрачность тепловой карты.
  - **max_history**: Максимальное количество записей в истории.
  - **history_file**: Файл для сохранения истории тепловой карты.

### Настройки алертов:
- **alerts**:
  - **zones**: Список зон с настройками.
  - **limits**: Лимиты игроков.
  - **movement_anomaly**: Настройки для обнаружения аномалий перемещения.

### Пример конфигурации зоны:

```yaml
zones:
  - name: "Спавн"
    bounds: {xmin: -500, xmax: 500, zmin: -500, zmax: 500}
    alert_level: "WARNING"
    cooldown: 30
    excluded: True  # Зона исключена из обработки алертов
  - name: "Сосмарк"
    bounds: {xmin: 4124, xmax: 5291, zmin: -3465, zmax: -2225}
    allowed_players: ["K1zik", "Kwakich", "_DeN41k_"]
    alert_level: "CRITICAL"
    cooldown: 60
```

---

## Использование

### Основные функции:
1. **Запуск приложения**:
   - После запуска откроется окно с картой, на которой отображаются позиции игроков.

2. **Тепловая карта**:
   - Включите или отключите отображение тепловой карты для визуализации активности игроков.

3. **Оповещения**:
   - Следите за активными алертами в логах и на графике.
   - Алерты отображаются на карте с указанием типа и уровня важности.

4. **Экспорт данных**:
   - Используйте команду `--export` для экспорта данных в нужный формат:
     ```bash
     python main.py --export player_zone_time
     ```

---

## Оповещения

NoSos автоматически проверяет:
- Вход в запрещённые зоны.
- Превышение максимального количества игроков.
- Некорректные или пропущенные данные.

Все события логируются в файл `monitor.log`. Пример логов:

```
2025-01-26 14:30:00,000 - MainThread - INFO - Загружено записей истории: 24955
2025-01-26 14:30:01,000 - MainThread - WARNING - АКТИВНЫЙ АЛЕРТ: Игрок Player1 в зоне Сосмарк
```

---

## История тепловой карты

Исторические данные активности игроков сохраняются в файле `heatmap_history.pkl`. Для загрузки истории используется метод `load_history()`, а для сохранения — `save_history()`.

---

## Экспорт данных

NoSos поддерживает экспорт данных в различные форматы:
- **CSV**: Экспорт статистики игроков и зон.
- **JSON**: Экспорт данных в формате JSON.
- **Excel**: Экспорт данных в Excel.
- **Player-Zone Time**: Экспорт времени, проведённого игроками в зонах.

Пример команды для экспорта:
```bash
python main.py --export player_zone_time
```

---

## Основные классы

- **Alert**: Класс для хранения информации об алерте.
- **BaseAlertRule**: Базовый класс для правил генерации алертов.
- **ZoneIntrusionRule**: Правило для проверки вторжений в зоны.
- **PlayerCountRule**: Правило для проверки лимита игроков.
- **AlertManager**: Управляет правилами и обработкой алертов.
- **NoSos**: Основной класс приложения, отвечающий за инициализацию и запуск.

---

## Лицензия

Этот проект распространяется под лицензией MIT. Подробнее см. файл [LICENSE](LICENSE).

---

## Поддержка

Если у вас возникли вопросы или проблемы, создайте issue в репозитории проекта. Мы постараемся помочь вам как можно скорее!
